import"./policies-MHeGXn1W.js";document.addEventListener("DOMContentLoaded",()=>{const l=document.getElementById("calendar");new FullCalendar.Calendar(l,{plugins:[FullCalendar.DayGrid,FullCalendar.Interaction],initialView:"dayGridMonth",validRange:{start:"2024-10-25",end:"2070-12-31"},events:async function(t,r,e){const s=sessionStorage.getItem("token");try{const a=(await(await fetch("https://lm-server-server.onrender.com/api/calendar",{headers:{Authorization:`Bearer ${s}`}})).json()).map(o=>({title:`${o.peg}: ${o.status==="available"?"Available":"Booked"}`,date:o.date,backgroundColor:o.status==="available"?"green":"red",borderColor:o.status==="available"?"darkgreen":"darkred",peg:o.peg,status:o.status}));r(a)}catch(n){console.error("Error fetching calendar events:",n),e(n)}},eventClick:async function(t){const r=sessionStorage.getItem("token");if(!r){alert("You must be logged in to edit the calendar.");return}const e=t.event.extendedProps.peg,s=t.event.start.toLocaleDateString("en-CA"),n=t.event.extendedProps.status,d=n==="available"?"booked":"available";try{const a=await fetch("https://lm-server-server.onrender.com/api/calendar/book",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({date:s,peg:e,currentStatus:n})});if(a.ok)t.event.setProp("backgroundColor",d==="booked"?"red":"green"),t.event.setProp("title",`${e}: ${d==="booked"?"Booked":"Available"}`),t.event.setExtendedProp("status",d);else{const o=await a.json();alert(o.message)}}catch(a){console.error("Error during fetch request:",a)}}}).render()});const g="https://lm-server-server.onrender.com";document.addEventListener("DOMContentLoaded",()=>{document.getElementById("login-form").addEventListener("submit",async i=>{i.preventDefault();const t=document.getElementById("email").value,r=document.getElementById("password").value;try{const e=await fetch(g,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,password:r})});if(!e.ok){const n=await e.json().catch(()=>({error:"Unknown error occurred"}));throw new Error(n.error)}const s=await e.json();console.log("Login successful:"),sessionStorage.setItem("token",s.token),alert("Login successful!"),c()}catch(e){console.error("Login failed:",e.message),alert("Login failed: "+e.message)}}),document.getElementById("logoutButton").addEventListener("click",function(){sessionStorage.removeItem("token"),c()}),c()});const u=document.getElementById("loginStatus");function c(){sessionStorage.getItem("token")?u.textContent="You are logged in. You can edit the calendar.":u.textContent="To edit the calendar, please log in."}window.addEventListener("beforeunload",function(){sessionStorage.removeItem("token")});
