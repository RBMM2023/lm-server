import"./policies-B5oi3ykB.js";import{C as u,i as m,a as p}from"./fullcalendar-DVHRDwe0.js";document.addEventListener("DOMContentLoaded",()=>{const i=document.getElementById("calendar");new u(i,{plugins:[m,p],initialView:"dayGridMonth",validRange:{start:"2024-10-25",end:"2070-12-31"},events:async function(o,a,e){const s=sessionStorage.getItem("token");try{const r=(await(await fetch("https://lm-server-server.onrender.com/api/calendar",{headers:{Authorization:`Bearer ${s}`}})).json()).map(t=>({title:`${t.peg}: ${t.status==="available"?"Available":"Booked"}`,date:t.date,backgroundColor:t.status==="available"?"green":"red",borderColor:t.status==="available"?"darkgreen":"darkred",peg:t.peg,status:t.status}));a(r)}catch(n){console.error("Error fetching calendar events:",n),e(n)}},eventClick:async function(o){const a=sessionStorage.getItem("token");if(!a){alert("You must be logged in to edit the calendar.");return}const e=o.event.extendedProps.peg,s=o.event.start.toLocaleDateString("en-CA"),n=o.event.extendedProps.status,d=n==="available"?"booked":"available";try{const r=await fetch("https://lm-server-server.onrender.com/api/calendar/book",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({date:s,peg:e,currentStatus:n})});if(r.ok){const t=await r.json();o.event.setProp("backgroundColor",d==="booked"?"red":"green"),o.event.setProp("title",`${e}: ${d==="booked"?"Booked":"Available"}`),o.event.setExtendedProp("status",d)}else{const t=await r.json();alert(t.message),console.error("Error booking peg:",t)}}catch(r){console.error("Error during fetch request:",r),alert("Failed to book the peg. Please try again.")}}}).render()});const k="https://lm-server-server.onrender.com/api/login";document.addEventListener("DOMContentLoaded",()=>{document.getElementById("login-form").addEventListener("submit",async c=>{c.preventDefault();const o=document.getElementById("email").value,a=document.getElementById("password").value;try{const e=await fetch(k,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:o,password:a})});if(!e.ok){const n=await e.json().catch(()=>({error:"Unknown error occurred"}));throw new Error(n.error)}const s=await e.json();console.log("Login successful:"),sessionStorage.setItem("token",s.token),alert("Login successful!"),l()}catch(e){console.error("Login failed:",e.message),alert("Login failed: "+e.message)}}),document.getElementById("logoutButton").addEventListener("click",function(){sessionStorage.removeItem("token"),l()}),l()});const g=document.getElementById("loginStatus");function l(){sessionStorage.getItem("token")?g.textContent="You are logged in. You can edit the calendar.":g.textContent="To edit the calendar, please log in."}window.addEventListener("beforeunload",function(){sessionStorage.removeItem("token")});
